# 【风控算法】模型可解释性和评分卡模型

风险控制是金融领域比较常见的一类业务，而风控模型算法的应用则包含了统计学，机器学习等很多知识领域。信贷，反欺诈，损益预测，资产管理等都是其常见的应用场景。这次简单总结讲两个模块：可解释性原理和评分卡模型。

## 1. 可解释性原理

可解释机器学习在这几年慢慢成为了机器学习的重要研究方向。作为数据科学家需要防止模型存在偏见，且帮助决策者理解如何正确地使用我们的模型。越是严苛的场景，越需要模型提供证明它们是如何运作且避免错误的证据。而在金融领域，可解释性是一个十分重要的部分，只有可解释性强的模型，可以提升客户对模型的决策的可信度。

可解释性的重要性体现在如下点：

- 可解释性是一个人可以理解决策原因的度，并且可以依照这个度来预测模型的结果。
- 社会进程的增加对ML的可解释性提出需求，所以需要对ML的行为提供一个可以接受的可解释性，而且可解释性可以用来管理社会反映。
- 如果机器学习模型可以解释决策，则也对公平，隐私，依赖性，鲁棒性，泛化性都有帮助。

可解释性的分类：

- 本值vs事后分析。

可解释性方法：

- 特征统计值结果。
- 特征总结可视化。
- 模型内部构件。
- 数据点分析。
- 用一个可解释模型去逼近。

可解释性的视角：

- 算法透明度。
- 全局模型可解释性。
- 模块化水平的全局模型可解释性（比如线性模型权重，树模型分割点，并且线性模型的权重也比神经网络的权重有更好的可解释性）。
- 单个预测得据部解释性。
- 对于一个预测群体的局部可解释性。

验证可解释性：

- 应用级别的验证（在产品中放入可解释性）。
- 人类级别验证（外行评测）。
- 功能级别验证（具体在模型上的参数差别）。

可解释性的特性：可解释性是认为可以理解的，通常联系样本的特征之以及模型预测值。

- 可解释性方法特性：表达力，透明度，算法复杂度，可移植性。
- 单独解释性特征：准确率，抱着怒，稳定性，易理解性，确定性，重要性度量，新奇性，代表性。

目前的可解释性方法分为两类：

- 可解释性模型：线性模型，树模型，GLM，GAMs，FuleFit，朴素贝叶斯分类器，KNN
- 模型无关方法
  - 部份依赖图（PDP）
  - 个体条件期望图（ICE）
  - 局部可解释不可知模型（LIME）
  - Shapley值可加性解释模型（SHAP）

## 2. 评分卡模型

之所以回有出现信用评分卡模型，是由于零售信贷业务具有笔数多、单笔金额小、数据丰富的特征，决定了需要对其进行智能化、概率化的管理模式。信用评分模型运用现代的数理统计模型技术，通过对借款人信用历史记录和业务活动记录的深度数据挖掘、分析和提炼，发现蕴藏在纷繁复杂数据中、反映消费者风险特征和预期信贷表现的知识和规律，并通过评分的方式总结出来，作为管理决策的科学依据。

目前国内大多数银行信用卡部门采取人工审批作业形式，审批依据是审批政策、客户提供的资料及审批人员的个人经验进行审批判断。而人工判断会有主观性，并且不利于量化风险分级管理，并且信审人员对提交材料的真实性认定基本依赖于受理申请仔脚的信贷业务员的职业操守和业务素质，人工成本很高。

而信用评分卡具有客观性，它是根据从大量数据中提炼出来的预测信息和行为模式制定的，反映了借款人信用表现的普遍性规律，在实施过程中不会因审批人员的主观感受、个人偏见、个人好恶和情绪等改变，减少了审批员过去单凭人工经验进行审批的随意性和不合理性。 并且信用评分卡具有一致性，准确性，还可以提高效率，所以越来越多的在银行信贷业务中扮演重要角色。

评分卡模型作为风控模型中的经典模型，主要根据贷款人的行为和所在阶段分为A卡（客户申请评分卡），B卡（贷中行为评分卡），C卡（催收行为评分卡）

- A卡

  A卡即申请评分模型，此类风控模型的目的在于预测申请时点（申请信用卡、申请贷款）未来一定时间内逾期的概率。Y变量的设定观察点为申请时点，定义为表现期内是否逾期。X变量一般只有客户填写的申请书信息，加上外部查询的数据与征信报告。

- B卡

  B卡即行为评分模型，此类风控模型的目的在于预测使用时点（获得贷款、信用卡的使用期间）未来一定时间内逾期的概率。Y变量设定观察点为使用期间的某一时点，定义为表现期内是否逾期。由于行为评分模型的观察点在获得贷款或信用卡之后，这段时间内是可以获取到贷款或信用卡的使用还款行为数据的。另外使用过程中同样可以查询外部数据和征信报告的变化，这些行为数据衍生成x变量后，模型的效果会大大提升。

- C卡

  C卡即催收评分模型，此类风控模型的目的在于预测进入催收阶段后未来一定时间内还款的概率。Y变量设定的观察点为进入催收阶段的时点，定义为表现期内是否还款。催收评分模型有一个特有的数据，那就是催收的行为。比如打过几次电话，是否约定还款等等，这些催收行为x变量会影响催收模型的效果。

评分卡模型的开发步骤：

1. 数据获取，包括获取存量客户及潜在客户的数据；存量客户，已开展融资业务的客户，包括个人客户和机构客户；潜在客户，将要开展业务的客户。
2. EDA，获取样本整体情况，进行直方图、箱形图可视化.
3. 数据预处理，包括数据清洗、缺失值处理、异常值处理。
4. 变量筛选，通过统计学的方法，筛选出对违约状态影响最显著的指标。主要有单变量特征选择和基于机器学习的方法。
5. 模型开发，包括变量分段、变量的WOE（证据权重）变换和逻辑回归估算三个部分。
6. 模型评估，评估模型的区分能力、预测能力、稳定性，并形成模型评估报告，得出模型是否可以使用的结论。
7. 生成评分卡（信用评分），根据逻辑回归的系数和WOE等确定信用评分的方法，将Logistic模型转换为标准评分的形式。
8. 建立评分系统（布置上线），根据生成的评分卡，建立自动信用评分系统。

- WOE编码

  WOE（Weight of Evidence）证据权重，是指标量的一种编码形式，常用于特征变换用来衡量自变量与因变量的相关性。

  ![](https://gitee.com/zhanghang23/picture_bed/raw/master/data%20science/woe.png)

  WOE在业务中得作用

  - **处理缺失值**：当数据源没有100%覆盖时，那就会存在缺失值，此时可以把null单独作为一个分箱。这点在分数据源建模时非常有用，可以有效将覆盖率哪怕只有20%的数据源利用起来。
  - **处理异常值**：当数据中存在离群点时，可以把其通过分箱离散化处理，从而提高变量的鲁棒性（抗干扰能力）。例如，age若出现200这种异常值，可分入“age > 60”这个分箱里，排除影响。
  - **业务解释性**：我们习惯于线性判断变量的作用，当x越来越大，y就越来越大。但实际x与y之间经常存在着**非线性**关系，此时可经过WOE变换。

- IV值

  IV衡量一个变量的风险区分能力,即衡量各变量对y的预测能力，用于筛选变量

  ![](https://gitee.com/zhanghang23/picture_bed/raw/master/data%20science/iv.png)

  IV值得计算可以看作是一个WOE得加权和。

- WOE和IV得计算步骤

  1. 对于连续型变量，进行分箱（binning），可以选择等频、等距，或者自定义间隔，对于离散型变量，如果分箱太多，则进行分箱合并。
  2. 统计每个分箱里的好人数(bin_goods)和坏人数(bin_bads)。
  3. 分别除以总的好人数(total_goods)和坏人数(total_bads)，得到每个分箱内的边际好人占比margin_good_rate和边际坏人比margin_bad_rate。
  4. 计算每个分箱的WOE。
  5. 检查每个分箱（除null分箱外）里woe值是否满足**单调性**，若不满足，返回step1。注意⚠️：null分箱由于有明确的业务解释，因此不需要考虑满足单调性。
  6. 计算每个分箱里的IV，最终求和，即得到最终的IV。

- 在IV计算中需要注意的事情

  - 分箱时需要注意样本量充足，保证统计意义。

  - 若相邻分箱的WOE值相同，则将其合并为一个分箱。

  - 当一个分箱内只有好人或坏人时，可对WOE公式进行修正如下：

    ![](https://gitee.com/zhanghang23/picture_bed/raw/master/data%20science/woe_1.png)